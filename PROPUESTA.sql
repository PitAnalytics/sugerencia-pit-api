SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
SET time_zone = "-05:00";

CREATE DATABASE IF NOT EXISTS `PROPUESTA` DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci;
USE `PROPUESTA`;

DROP TABLE IF EXISTS `Orden`;
CREATE TABLE `Orden` (
  `id` int(11) NOT NULL,
  `numeroProveedor` varchar(16) COLLATE utf8_unicode_ci NOT NULL,
  `codigoPep` varchar(32) COLLATE utf8_unicode_ci NOT NULL,
  `monto` float(10,2) NOT NULL,
  `numeroPedido` varchar(16) COLLATE utf8_unicode_ci NOT NULL,
  `fecha` date NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

TRUNCATE TABLE `Orden`;

INSERT INTO `Orden` (`id`, `numeroProveedor`, `codigoPep`, `monto`, `numeroPedido`, `fecha`) VALUES
(14, '100986', 'BN-AD/CG-MC-001-1', 45000.00, '4500054597', '2018-01-15'),
(15, '100986', 'GI-APL-CNL-B10-202-003', 678000.00, '4500034567', '2018-02-15'),
(16, '100986', 'GI-APL-CNL-B11-202-001', 4567773.00, '4500034568', '2018-02-15'),
(70, '104053', 'BN-AD/CG-MC-001-1', 456666.00, '4500034568', '2018-01-15'),
(77, '100986', 'BN-AD/CG-MC-001-1', 67888.00, '4500054597', '2019-01-15'),
(78, '100986', 'GI-APL-CNL-B10-202-003', 345666.00, '4500034567', '2019-02-15'),
(79, '104053', 'BN-AD/CG-MC-001-1', 67888.00, '4500034568', '2019-01-15'),
(81, '104053', 'GI-APL-CNL-B10-202-003', 1234565.00, '4500034571', '2019-02-15'),
(82, '103925', 'GI-INF-TLC-B23-203-149', 67888.00, '4500054598', '2019-01-15');

DROP TABLE IF EXISTS `Pedido`;
CREATE TABLE `Pedido` (
  `numero` varchar(16) COLLATE utf8_unicode_ci NOT NULL,
  `concepto` varchar(256) COLLATE utf8_unicode_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

TRUNCATE TABLE `Pedido`;

INSERT INTO `Pedido` (`numero`, `concepto`) VALUES
('4500034567', 'SOPORTE PROD POST SALIDA Y ENVIO DE BANCA ELECTRONICA $2,076,785.10 ESTE SERVICIO CORRE DE SEPTIEMBRE DE 2018 A JUNIO DE 2019 (VENCIDO) SE AMORTIZO A PARTIR DE JULIO DE 2019 HASTA DICIEMBRE DE 2019 POR LO QUE NO HAY COMPARATIVOS EN EL AÑO DE 2018.'),
('4500034568', 'MANTENIMIENTO LIC IBM (WAS, MESSAGE, BROKER) POR $1,556,669.02 MXN, LA AMORTIZACIÓN CORRE A PARTIR DE DICIEMBRE DE 2018, POR LO QUE NO HAY COMPARATIVOS EN EL PERIODO DE ENERO A JULIO DE 2018.'),
('4500034569', 'A. LICENCIAS SIES-ADMIN-SPEI T24'),
('4500034570', 'P MTTO SOP TECN*SIES SOL SOFTWAR'),
('4500034571', 'SERVICIOS DE CONSULTORIA SISTEMA T24 (RECURSOS), PROYECTO RECOMPRA DE CARTERA IMSS, ANALISIS DESARROLLO Y PRUEBAS INTEGRALES, ASI COMO OTROS PROYECTOS'),
('4500034572', 'INCREMENTO EN EL PAGO DE LICENCIAMIENTOS USUARIOS T-24 DE $423,342.54 USD EN 2018 A 536,276.98 USD EN 2019'),
('4500054597', 'FACTURA (140) LICENCIAS SIES-ADMIN-SPEI T24 CORRESPONDIENTE A 2017 POR $346,554.42 MXN, OTORGAMIENTO DE LICENCIAS \"SIES ADMIN SPEI T-24'),
('4500054598', 'PROPUESTA SWITCHES NOKIA*CLOUD IT SERVICIO');

DROP TABLE IF EXISTS `Pep`;
CREATE TABLE `Pep` (
  `codigo` varchar(32) COLLATE utf8_unicode_ci NOT NULL,
  `descripcion` varchar(128) COLLATE utf8_unicode_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

TRUNCATE TABLE `Pep`;

INSERT INTO `Pep` (`codigo`, `descripcion`) VALUES
('BN-AD/CG-MC-001-1', 'Implementacion Web Cta Gastos (Licencias)'),
('BN-OP/OS-RE-001-1,1', 'Mantenimiento de Software'),
('GI-APL-CNL-B10-202-003', 'Mantenimiento de Software'),
('GI-APL-CNL-B11-202-001', 'Mantenimiento de Licencias Banca por Internet'),
('GI-INF-TLC-B23-203-149', 'SWITCHES TOR ACCESO');

DROP TABLE IF EXISTS `Proveedor`;
CREATE TABLE `Proveedor` (
  `numero` varchar(16) COLLATE utf8_unicode_ci NOT NULL,
  `nombre` varchar(128) COLLATE utf8_unicode_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

TRUNCATE TABLE `Proveedor`;

INSERT INTO `Proveedor` (`numero`, `nombre`) VALUES
('100986', 'SIES SOLUCIONES DE SOFTWARE SA DE CV'),
('103925', 'CLOUD IT SERVICES SA DE CV'),
('104053', 'STRATEGY ADDED SA DE CV');
es de la tabla `Orden`

ALTER TABLE `Orden`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `id` (`id`),
  ADD KEY `numeroProveedor` (`numeroProveedor`),
  ADD KEY `codigoPep` (`codigoPep`),
  ADD KEY `numeroPedido` (`numeroPedido`);

ALTER TABLE `Pedido`
  ADD PRIMARY KEY (`numero`);

ALTER TABLE `Pep`
  ADD PRIMARY KEY (`codigo`),
  ADD UNIQUE KEY `codigo` (`codigo`);

ALTER TABLE `Proveedor`
  ADD PRIMARY KEY (`numero`),
  ADD UNIQUE KEY `numero` (`numero`);

ALTER TABLE `Orden`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=83;

ALTER TABLE `Orden`
  ADD CONSTRAINT `Orden_ibfk_1` FOREIGN KEY (`numeroProveedor`) REFERENCES `Proveedor` (`numero`) ON DELETE CASCADE ON UPDATE CASCADE,
  ADD CONSTRAINT `Orden_ibfk_2` FOREIGN KEY (`codigoPep`) REFERENCES `Pep` (`codigo`) ON DELETE CASCADE ON UPDATE CASCADE,
  ADD CONSTRAINT `Orden_ibfk_3` FOREIGN KEY (`numeroPedido`) REFERENCES `Pedido` (`numero`) ON DELETE CASCADE ON UPDATE CASCADE;